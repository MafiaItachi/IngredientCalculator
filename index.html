<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
      rel="stylesheet"
    />
    <title>Ingredient Table</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap");
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        padding-top: 12PX;
        font-family: "Poppins", sans-serif;
        font-size: 1.1em;
        background-color: #F7F7F7;
        color: #F7F7F7;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
      }
      h1 {
        font-size: 1.8em;
        margin-bottom: 10px;
        color: black;
      }
      select {
        padding: 8px;
        font-size: 14px;
        background-color: #333;
        color: #F7F7F7;
        border: none;
        border-radius: 6px;
        outline: none;
        cursor: pointer;
        width: 100%;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }
      th,
      td {
        font-family: "Poppins", sans-serif;
        font-size: 1em;
        padding: 6px;
        text-align: center;
      }
      th {
        background-color: #B5720D;
        color: #F7F7F7;
        height: 10px;
      }
      tr:nth-child(even) {
        background-color: #2a2a2a;
      }
      tr:hover {
        background-color: #3a3a3a;
        transition: 0.2s;
      }
      img {
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 5px;
      }
      .editable,
      #kgInput,
      #MemberInput {
        font-family: "Poppins", sans-serif;
        width: 60px;
        text-align: center;
        background: transparent;
        border: NONE;
        color: #F7F7F7;
        margin: 0;
        font-size: 1em;
        /* border-radius: 4px; */
        /* padding: 2px; */
      }
      button {
        font-family: "Poppins", sans-serif;
        padding: 10px 16px;
        font-size: 16px;
        font-weight: bold;
        color: #F7F7F7;
        background-color: #B5720D;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 10px 5px;
      }

      button:hover {
        background-color: #B5720D;
      }

      button:active {
        background-color: #B5720D;
        transform: scale(0.98);
      }

      button:nth-of-type(2) {
        /* Reset button */
        background-color: #854836;
      }
      button:nth-of-type(4) {
        /* Remove all button */
        background-color: #854836;
      }


      @media (max-width: 768px) {
        body {
          font-size: 1em;
        }

        .container {
          width: 100%;
        }

        h1 {
          font-size: 1.4em;
        }

        select,
        input,
        button {
          font-size: 14px;
          padding: 8px;
          width: 100%;
          margin-bottom: 8px;
        }

        table {
          overflow-x: auto;
          #F7F7F7-space: nowrap;
        }

        th,
        td {
          padding: 6px 4px;
          font-size: 0.9em;
          height: 42px;
          align-items: center;
        }

        img {
          width: 40px;
          height: 40px;
        }

        .btn {
          display: flex;
          /* flex-direction: column;
        gap: 8px; */
        }

        button {
          /* width: 100%; */
          font-size: 14px;
          padding: 12px;
        }
        .input {

          font-size: 1.2em;
          font-weight: bold;
          border-radius: 4px;
          margin: 20px 4px 8px 4px;
          display: flex;
          justify-content: center;
          align-items: center;
        }
        #kgInput,
        #MemberInput {
          font-size: 1.1em;
          font-weight: bold;
          border-radius: 4px;
          font-family: "Poppins", sans-serif;
          padding: 0;
        }
      }
      .tab {
        display: flex;
        flex-direction: row;
        width: 95%;
        justify-content: space-around;
      }
      .tab button {
        background-color: #F7F7F7;
        color: #000000;
        margin: 0;
        border: none;
      }
      .tab button.active {
        background-color: black; /* Active tab color */
        color: #F7F7F7;
        border-radius: 10px 10px 0 0; /* Fully rounded */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Add some shadow */
      }
      .Veg,
      .NonVeg {
        background-color: black;
        width: 100%;
        border: none;
        margin: 0;
      }
      .max {
        width: 153px;
      }
    </style>
  </head>
  <body>
    <h1>INGREDIENT TABLE</h1>
    <div class="tab">
      <button id="veg">NON-VEG</button>
      <button id="nonveg">VEG</button>
    </div>
    <div style="display: none" class="Veg">
      <div class="input">
        <label for="kgInput">HOW MANY MEMBERS :</label>
        <input
          type="number"
          id="MemberInput"
          min="1"
          step="1"
          value="4"
          onkeypress="if(event.key==='Enter'){updateTableVeg();}"
        />
      </div>
      <div class="btn">
        <button onclick="updateTableVeg()">CALCULATE</button>
        <button onclick="resetTable()">RESET</button>
        <button onclick="addAll()">ADD All</button>
        <button onclick="removeAll()">REMOVE All</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>IMAGE</th>
            <th class="max">ITEM</th>
            <th>QUANTITY</th>
            <th>UNIT</th>
            <th>ACTION</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <tr>
            <td><img src="src/potato.jpg" alt="Potato" /></td>
            <td>POTATO</td>
            <td><input type="number" class="editable" value="750" /></td>
            <td class="unit">gm</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/tomato.jpg" alt="Tomato" /></td>
            <td>TOMATO</td>
            <td><input type="number" class="editable" value="3" /></td>
            <td class="unit">pcs</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/onion.jpg" alt="Onion" /></td>
            <td>ONION</td>
            <td><input type="number" class="editable" value="250" /></td>
            <td class="unit">gm</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/rice.jpg" alt="Rice" /></td>
            <td>RICE</td>
            <td><input type="number" class="editable" value="680" /></td>
            <td class="unit">gm</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/dal.jpg" alt="Dal" /></td>
            <td>DAL</td>
            <td><input type="number" class="editable" value="100" /></td>
            <td class="unit">gm</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/ginger.jpg" alt="Ginger" /></td>
            <td>GINGER</td>
            <td><input type="number" class="editable" value="33" /></td>
            <td class="unit">gm</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/garlic.jpg" alt="Garlic" /></td>
            <td>GARLIC</td>
            <td><input type="number" class="editable" value="20" /></td>
            <td class="unit">gm</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/chili.jpg" alt="Chili" /></td>
            <td>CHILLI</td>
            <td><input type="number" class="editable" value="5" /></td>
            <td class="unit">INR</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/egg.jpg" alt="egg" /></td>
            <td>EGG</td>
            <td><input type="number" class="editable" value="4" /></td>
            <td class="unit">pce</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/oil.jpg" alt="Oil" /></td>
            <td>OIL</td>
            <td><input type="number" class="editable" value="33" /></td>
            <td class="unit">gm</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/salt.jpg" alt="Salt" /></td>
            <td>SALT</td>
            <td><input type="number" class="editable" value="1" /></td>
            <td class="unit">pac</td>
            <td class="action" data-state="add">✅</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="NonVeg">
      <div class="input">
        <label for="kgInput">CHICKEN QUANTITY :</label>
        <input
          type="number"
          id="kgInput"
          min="0.1"
          step="0.1"
          value="1"
          onkeypress="if(event.key==='Enter'){updateTable();}"
        /> <label for="kgInput">KG</label>
      </div>
      <div class="btn">
        <button onclick="updateTable()">CALCULATE</button>
        <button onclick="resetTable()">RESET</button>
        <button onclick="addAll()">ADD All</button>
        <button onclick="removeAll()">REMOVE All</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>IMAGE</th>
            <th>ITEM</th>
            <th id="kgHeader">QUANTITY</th>
            <th>UNIT</th>
            <th>ACTION</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <tr>
            <td><img src="src/chicken.jpg" alt="Chicken" /></td>
            <td>CHICKEN</td>
            <td><input type="number" class="editable" value="1000" /></td>
            <td class="unit">gm  </td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/potato.jpg" alt="Potato" /></td>
            <td>POTATO</td>
            <td><input type="number" class="editable" value="500" /></td>
            <td class="unit">gm</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/tomato.jpg" alt="Tomato" /></td>
            <td>TOMATO</td>
            <td><input type="number" class="editable" value="2" /></td>
            <td class="unit">pcs</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/onion.jpg" alt="Onion" /></td>
            <td>ONION</td>
            <td><input type="number" class="editable" value="250" /></td>
            <td class="unit">gm</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/rice.jpg" alt="Rice" /></td>
            <td>RICE</td>
            <td><input type="number" class="editable" value="680" /></td>
            <td class="unit">gm</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/dal.jpg" alt="Dal" /></td>
            <td>DAL</td>
            <td><input type="number" class="editable" value="100" /></td>
            <td class="unit">gm</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/ginger.jpg" alt="Ginger" /></td>
            <td>GINGER</td>
            <td><input type="number" class="editable" value="33" /></td>
            <td class="unit">gm</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/garlic.jpg" alt="Garlic" /></td>
            <td>GARLIC</td>
            <td><input type="number" class="editable" value="20" /></td>
            <td class="unit">gm</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/chili.jpg" alt="Chili" /></td>
            <td>CHILLI</td>
            <td><input type="number" class="editable" value="5" /></td>
            <td class="unit">INR</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/oil.jpg" alt="Oil" /></td>
            <td>OIL</td>
            <td><input type="number" class="editable" value="33" /></td>
            <td class="unit">gm</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/jeera.jpg" alt="Jeera" /></td>
            <td>JEERA POWDER</td>
            <td><input type="number" class="editable" value="1" /></td>
            <td class="unit">pac</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/dhone.jpg" alt="Dhone" /></td>
            <td>DHONE POWDER</td>
            <td><input type="number" class="editable" value="1" /></td>
            <td class="unit">pac</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/turmeric.jpg" alt="Turmeric" /></td>
            <td>TURMERIC POWDER</td>
            <td><input type="number" class="editable" value="1" /></td>
            <td class="unit">pac</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/meat-masala.jpg" alt="Meat Masala" /></td>
            <td>MEAT MASALA</td>
            <td><input type="number" class="editable" value="1" /></td>
            <td class="unit">pac</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/garam-masala.jpg" alt="Garam Masala" /></td>
            <td>GOROM MASALA</td>
            <td><input type="number" class="editable" value="1" /></td>
            <td class="unit">pac</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/kashmiri-chili.jpg" alt="Kashmiri Chili" /></td>
            <td>KASHMERI CHILLI</td>
            <td><input type="number" class="editable" value="1" /></td>
            <td class="unit">pac</td>
            <td class="action" data-state="add">✅</td>
          </tr>
          <tr>
            <td><img src="src/salt.jpg" alt="Salt" /></td>
            <td>SALT</td>
            <td><input type="number" class="editable" value="1" /></td>
            <td class="unit">pac</td>
            <td class="action" data-state="add">✅</td>
          </tr>
        </tbody>
      </table>
    </div>

    <script>
      // Function to select the entire value when the input is clicked or focused
      function selectKgInput() {
        setTimeout(() => document.getElementById("kgInput").select(), 50);
        setTimeout(() => document.getElementById("MemberInput").select(), 50);
      }

      // Attach event listeners to kgInput for fast selection
      document
        .getElementById("kgInput")
        .addEventListener("click", selectKgInput);
      document
        .getElementById("kgInput")
        .addEventListener("focus", selectKgInput);

      document
        .getElementById("MemberInput")
        .addEventListener("click", selectKgInput);
      document
        .getElementById("MemberInput")
        .addEventListener("focus", selectKgInput);

      // Update table function
      function updateTable(updateURL = true) {
        let kgInput = document.getElementById("kgInput");
        let kg = parseFloat(kgInput.value);
        if (isNaN(kg) || kg <= 0) return;

        let inputs = document.querySelectorAll(".editable");
        let values = [];

        inputs.forEach((input) => {
          let baseValue = input.dataset.base || input.value;
          input.dataset.base = baseValue;

          let newValue = (baseValue * kg).toFixed(2).replace(/\.?0+$/, ""); // Remove trailing .00 or .0
          input.value = newValue;
          values.push(newValue);
        });

        if (updateURL) updateURLParams(kg, values);
      }
      // Move focus to the next editable input when Enter or Tab is pressed
      function moveToNextInput(event) {
        if (event.key === "Enter" || event.key === "Tab") {
          event.preventDefault(); // Prevent default behavior (like form submission)

          let inputs = Array.from(document.querySelectorAll(".editable"));
          let currentIndex = inputs.indexOf(event.target);

          // Move to the next input or loop back to the first
          let nextIndex = (currentIndex + 1) % inputs.length;
          let nextInput = inputs[nextIndex];

          nextInput.focus();
          nextInput.select(); // Select the entire value for quick editing
        }
      }

      // Automatically select the value when an editable field is clicked
      function selectOnClick(event) {
        event.target.select();
      }

      // Attach event listeners for editable inputs
      function attachEditableListeners() {
        document.querySelectorAll(".editable").forEach((input) => {
          input.addEventListener("keydown", moveToNextInput); // Enter/Tab key navigation
          input.addEventListener("click", selectOnClick); // Click to select all

          // Ensure selection works on mobile (touch devices)
          input.addEventListener("focus", function () {
            setTimeout(() => input.select(), 50);
          });
        });
      }

      // Add All and Remove All functions
      function addAll() {
        document.querySelectorAll(".action").forEach((action) => {
          action.dataset.state = "add";
          action.textContent = "✅";
        });
        updateURLParams();
      }

      function removeAll() {
        document.querySelectorAll(".action").forEach((action) => {
          action.dataset.state = "remove";
          action.textContent = "❌";
        });
        updateURLParams();
      }

      // New function to toggle between ✅ and ❌
      function toggleAction(element) {
        let state = element.dataset.state;

        if (state === "add") {
          element.textContent = "❌"; // Change to removed
          element.dataset.state = "remove";
        } else {
          element.textContent = "✅"; // Change back to added
          element.dataset.state = "add";
        }

        updateURLParams(); // Update the URL when the action is toggled
      }

      // Attach click event listeners to action buttons (✅/❌ toggle)
      function attachActionListeners() {
        document.querySelectorAll(".action").forEach((action) => {
          action.addEventListener("click", function () {
            toggleAction(this);
          });
        });
      }

      document.addEventListener("DOMContentLoaded", function () {
        makeUnitEditable();
        loadFromURL();
      });

      function makeUnitEditable() {
        document.querySelectorAll("td.unit").forEach((td) => {
          td.addEventListener("click", function (event) {
            showUnitMenu(td, event);
          });
        });
      }

      function showUnitMenu(td) {
        let currentUnit = td.textContent.trim();
        let units = ["gm", "pcs", "pac", "INR"];

        // Remove existing menu if any
        let existingMenu = document.getElementById("unit-menu");
        if (existingMenu) {
          existingMenu.remove();
        }

        // Create the full-page overlay
        let overlay = document.createElement("div");
        overlay.id = "unit-menu";
        overlay.style.position = "fixed";
        overlay.style.top = "0";
        overlay.style.left = "0";
        overlay.style.width = "100vw";
        overlay.style.height = "100vh";
        overlay.style.background = "rgba(0, 0, 0, 0.8)"; // Transparent black
        overlay.style.display = "flex";
        overlay.style.justifyContent = "center";
        overlay.style.alignItems = "center";
        overlay.style.zIndex = "1000";

        // Create the popup box
        let menu = document.createElement("div");
        menu.style.background = "black";
        menu.style.border = "1px solid #ccc";
        menu.style.borderRadius = "10px";
        menu.style.boxShadow = "0px 4px 10px black";
        menu.style.padding = "20px";
        menu.style.textAlign = "center";
        menu.style.minWidth = "200px";

        // Add unit options
        units.forEach((unit) => {
          let option = document.createElement("div");
          option.textContent = unit;
          option.style.padding = "10px";
          option.style.cursor = "pointer";
          option.style.background =
            currentUnit === unit ? "#444" : "transparent";
          option.style.color = "#F7F7F7";
          option.style.borderRadius = "5px";
          option.style.marginBottom = "5px";

          // Change unit on click
          option.addEventListener("click", function () {
            td.textContent = unit;
            updateURLParams();
            overlay.remove();
          });

          menu.appendChild(option);
        });

        // Close the popup when clicking outside
        overlay.addEventListener("click", function (event) {
          if (event.target === overlay) {
            overlay.remove();
          }
        });

        overlay.appendChild(menu);
        document.body.appendChild(overlay);
      }

      function updateURLParams(kg = null, values = null) {
        const newUrl = new URL(window.location);
        if (kg !== null) {
          newUrl.searchParams.set("kg", kg);
        } else {
          kg = parseFloat(document.getElementById("kgInput").value);
          newUrl.searchParams.set("kg", kg);
        }

        // Capture the current values of each editable field
        let inputs = document.querySelectorAll(".editable");
        let updatedValues =
          values || Array.from(inputs).map((input) => input.value);
        newUrl.searchParams.set("items", updatedValues.join(","));

        let units = Array.from(document.querySelectorAll("td.unit")).map((td) =>
          td.textContent.trim()
        );
        newUrl.searchParams.set("units", units.join(","));

        // Update the state of the actions (added/removed)
        let actions = Array.from(document.querySelectorAll(".action")).map(
          (action) => action.dataset.state
        );
        newUrl.searchParams.set("actions", actions.join(","));

        // Update the URL in the browser
        window.history.pushState({}, "", newUrl);
      }

      function loadFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        let kg = parseFloat(urlParams.get("kg")) || 1;
        document.getElementById("kgInput").value = kg;

        let items = urlParams.get("items");
        let inputs = document.querySelectorAll(".editable");

        if (items) {
          let values = items.split(",");
          inputs.forEach((input, index) => {
            if (values[index]) {
              input.value = values[index];
              // IMPORTANT: Set base value only if it hasn't been set before
              if (!input.dataset.base) {
                input.dataset.base = input.value / kg; // Set base value to restore later
              }
            }
          });
        } else {
          inputs.forEach((input) => {
            if (!input.dataset.base) {
              input.dataset.base = input.value; // Set base value on first load
            }
          });
        }

        let units = urlParams.get("units");
        if (units) {
          let unitValues = units.split(",");
          document.querySelectorAll("td.unit").forEach((td, index) => {
            if (unitValues[index]) {
              td.textContent = unitValues[index];
            }
          });
        }

        // Load actions from the URL
        let actions = urlParams.get("actions");
        if (actions) {
          let actionStates = actions.split(",");
          document.querySelectorAll(".action").forEach((action, index) => {
            action.dataset.state = actionStates[index];
            action.textContent = actionStates[index] === "add" ? "✅" : "❌";
          });
        }

        updateTable(false);
      }

      document
        .getElementById("kgInput")
        .addEventListener("keydown", function (event) {
          if (event.key === "Enter") {
            event.preventDefault();
            updateTable();
          }
        });

      // Single window.onload to avoid conflicts
      window.onload = function () {
        loadFromURL(); // Load existing URL parameters
        makeUnitEditable(); // Enable unit editing on the table

        // Attach input listeners to update URL when individual item values change
        document.querySelectorAll(".editable").forEach((input) => {
          input.addEventListener("input", function () {
            updateURLParams(); // Update URL when individual input is changed
          });
        });

        // Attach event listeners to the action buttons
        attachActionListeners(); // Ensure the toggle works for ✅ and ❌
        attachEditableListeners(); // Enable Enter key navigation
        loadTabState(); // Load tab state from URL
        loadFromURLVeg(); // Load Veg quantities
      };

      //vegetarian table

      document.addEventListener("DOMContentLoaded", function () {
        loadTabState(); // Load tab state from URL
        loadFromURLVeg(); // Load Veg quantities
        loadFromURL(); // Load NonVeg quantities
      });

      function switchTab(tab) {
        if (tab === "Veg") {
          document.querySelector(".Veg").style.display = "block";
          document.querySelector(".NonVeg").style.display = "none";
          document.getElementById("nonveg").classList.add("active");
          document.getElementById("veg").classList.remove("active");
        } else {
          document.querySelector(".Veg").style.display = "none";
          document.querySelector(".NonVeg").style.display = "block";
          document.getElementById("veg").classList.add("active");
          document.getElementById("nonveg").classList.remove("active");
        }

        const newUrl = new URL(window.location);
        newUrl.searchParams.set("tab", tab);
        window.history.pushState({}, "", newUrl);
      }

      // Load tab state on page load
      function loadTabState() {
        const urlParams = new URLSearchParams(window.location.search);
        let activeTab = urlParams.get("tab") || "NonVeg"; // Default to NonVeg
        switchTab(activeTab);
      }

      document.addEventListener("DOMContentLoaded", loadTabState);
      document
        .getElementById("veg")
        .addEventListener("click", () => switchTab("NonVeg"));
      document
        .getElementById("nonveg")
        .addEventListener("click", () => switchTab("Veg"));

      function resetTable() {
        const urlParams = new URLSearchParams(window.location.search);
        let activeTab = urlParams.get("tab") || "NonVeg"; // Get the current tab

        // Reset each editable input to its original base value
        let inputs = document.querySelectorAll(".editable");
        inputs.forEach((input) => {
          input.value = input.dataset.base; // Restore base value from dataset
        });

        // Reset all actions to the default 'add' state (✅)
        document.querySelectorAll(".action").forEach((action) => {
          action.dataset.state = "add";
          action.textContent = "✅"; // Reset to add state
        });

        // Create a new URL with only the tab parameter
        const newUrl = new URL(
          window.location.origin + window.location.pathname
        );
        newUrl.searchParams.set("tab", activeTab); // Keep only the tab parameter

        // Update the browser URL
        window.history.replaceState({}, document.title, newUrl.toString());

        // Reload the page to apply the reset
        location.reload();
      }

      // Function to update table for Veg Tab
      function updateTableVeg(updateURL = true) {
        let memberInput = document.getElementById("MemberInput");
        let members = parseInt(memberInput.value);
        if (isNaN(members) || members <= 0) return;

        let inputs = document.querySelectorAll(".Veg .editable");
        let values = [];

        inputs.forEach((input) => {
          let baseValue = input.dataset.default || input.value;
          input.dataset.default = baseValue; // Ensure default value is set

          let newValue = ((baseValue * members) / 4)
            .toFixed(2)
            .replace(/\.?0+$/, "");
          input.value = newValue;
          values.push(newValue);
        });

        if (updateURL) updateURLParamsVeg(members, values);
      }

      // Save Veg values in URL
      function updateURLParamsVeg(members = null, values = null) {
        const newUrl = new URL(window.location);
        newUrl.searchParams.set(
          "members",
          members || document.getElementById("MemberInput").value
        );

        let inputs = document.querySelectorAll(".Veg .editable");
        let updatedValues =
          values || Array.from(inputs).map((input) => input.value);
        newUrl.searchParams.set("vegItems", updatedValues.join(","));

        window.history.pushState({}, "", newUrl);
      }

      // Load Veg quantities from URL
      function loadFromURLVeg() {
        const urlParams = new URLSearchParams(window.location.search);
        let members = parseInt(urlParams.get("members")) || 4;
        document.getElementById("MemberInput").value = members;

        let items = urlParams.get("vegItems");
        let inputs = document.querySelectorAll(".Veg .editable");

        if (items) {
          let values = items.split(",");
          inputs.forEach((input, index) => {
            if (values[index]) {
              input.value = values[index];
              if (!input.dataset.default) {
                input.dataset.default = (input.value / members) * 4; // Default value for 4 members
              }
            }
          });
        } else {
          inputs.forEach((input) => {
            if (!input.dataset.default) {
              input.dataset.default = input.value; // Set default for 4 members
            }
          });
        }
      }
    </script>
  </body>
</html>
