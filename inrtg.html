<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
      rel="stylesheet"
    />
    <title>Ingredient Table</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Open Sans", sans-serif;
        font-size: 1.2em;
        background-color: #121212;
        color: #ffffff;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
      }
      .container {
        width: 100%;
        max-width: 800px;
        background-color: #1e1e1e;
        padding: 8px;
        box-shadow: 0 4px 10px rgba(255, 255, 255, 0.1);
        text-align: center;
      }
      h1 {
        font-size: 1.6em;
        margin-bottom: 10px;
      }
      select {
        padding: 8px;
        font-size: 14px;
        background-color: #333;
        color: white;
        border: none;
        border-radius: 6px;
        outline: none;
        cursor: pointer;
        width: 100%;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }
      th,
      td {
        font-size: 1em;
        padding: 6px;
        text-align: center;
      }
      th {
        background-color: #5163e9;
        color: white;
      }
      tr:nth-child(even) {
        background-color: #2a2a2a;
      }
      tr:hover {
        background-color: #3a3a3a;
        transition: 0.2s;
      }
      img {
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 5px;
      }
      .editable,
      #kgInput {
        width: 60px;
        text-align: center;
        background: transparent;
        border: NONE;
        color: white;
        margin: 0;
        font-size: 1em;
        /* border-radius: 4px; */
        /* padding: 2px; */
      }
      button {
        padding: 10px 16px;
        font-size: 16px;
        font-weight: bold;
        color: white;
        background-color: #5163e9;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 10px 5px;
      }

      button:hover {
        background-color: #3f51b5;
      }

      button:active {
        background-color: #2e3d9f;
        transform: scale(0.98);
      }

      button:nth-of-type(2) {
        /* Reset button */
        background-color: #e94e4e;
      }
      button:nth-of-type(4) {
        /* Remove all button */
        background-color: #e94e4e;
      }

      button:nth-of-type(2):hover {
        background-color: #c03939;
      }

      button:nth-of-type(2):active {
        background-color: #a82e2e;
      }

      @media (max-width: 768px) {
        body {
          font-size: 1em;
        }

        .container {
          width: 100%;
        }

        h1 {
          font-size: 1.4em;
        }

        select,
        input,
        button {
          font-size: 14px;
          padding: 8px;
          width: 100%;
          margin-bottom: 8px;
        }

        table {
          overflow-x: auto;
          white-space: nowrap;
        }

        th,
        td {
          padding: 6px 4px;
          font-size: 0.9em;
        }

        img {
          width: 40px;
          height: 40px;
        }

        .btn {
          display: flex;
          /* flex-direction: column;
        gap: 8px; */
        }

        button {
          /* width: 100%; */
          font-size: 14px;
          padding: 12px;
        }
        .input{
            background-color:#5163e9;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 4px;
            margin: 20px 4px 8px 4px;

        }
        #kgInput{
            background-color: #5163e9;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 4px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>INGREDIENT TABLE</h1>
      <div class="input">
        <label for="kgInput">ENTER CHICKEN QUANTITY (KG) :</label>
        <input
          type="number"
          id="kgInput"
          min="0.1"
          step="0.1"
          value="1"
          onkeypress="if(event.key==='Enter'){updateTable();}"
        />
      </div>
      <div class="btn">
        <button onclick="updateTable()">CALCULATE</button>
        <button onclick="resetTable()">RESET</button>
        <button onclick="addAll()">ADD All</button>
        <button onclick="removeAll()">REMOVE All</button>
      </div>

      <table>
        <thead>
          <tr>
            <th>IMAGE</th>
            <th>ITEM</th>
            <th id="kgHeader">QUANTITY</th>
            <th>UNIT</th>
            <th>ACTION</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <tr>
            <td><img src="src/chicken.jpg" alt="Chicken" /></td>
            <td>CHICKEN</td>
            <td><input type="number" class="editable" value="1000" /></td>
            <td>gm</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/potato.jpg" alt="Potato" /></td>
            <td>POTATO</td>
            <td><input type="number" class="editable" value="500" /></td>
            <td>gm</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/tomato.jpg" alt="Tomato" /></td>
            <td>TOMATO</td>
            <td><input type="number" class="editable" value="2" /></td>
            <td>pcs</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/onion.jpg" alt="Onion" /></td>
            <td>ONION</td>
            <td><input type="number" class="editable" value="250" /></td>
            <td>gm</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/rice.jpg" alt="Rice" /></td>
            <td>RICE</td>
            <td><input type="number" class="editable" value="680" /></td>
            <td>gm</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/ginger.jpg" alt="Ginger" /></td>
            <td>GINGER</td>
            <td><input type="number" class="editable" value="33" /></td>
            <td>gm</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/garlic.jpg" alt="Garlic" /></td>
            <td>GARLIC</td>
            <td><input type="number" class="editable" value="20" /></td>
            <td>gm</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/chili.jpg" alt="Chili" /></td>
            <td>CHILLI</td>
            <td><input type="number" class="editable" value="5" /></td>
            <td>INR</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/egg.jpg" alt="egg" /></td>
            <td>EGG</td>
            <td><input type="number" class="editable" value="4" /></td>
            <td>pce</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/oil.jpg" alt="Oil" /></td>
            <td>OIL</td>
            <td><input type="number" class="editable" value="33" /></td>
            <td>gm</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/jeera.jpg" alt="Jeera" /></td>
            <td>JEERA POWDER</td>
            <td><input type="number" class="editable" value="1" /></td>
            <td>pac</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/dhone.jpg" alt="Dhone" /></td>
            <td>DHONE POWDER</td>
            <td><input type="number" class="editable" value="1" /></td>
            <td>pac</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/turmeric.jpg" alt="Turmeric" /></td>
            <td>TURMERIC POWDER</td>
            <td><input type="number" class="editable" value="1" /></td>
            <td>pac</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/meat-masala.jpg" alt="Meat Masala" /></td>
            <td>MEAT MASALA</td>
            <td><input type="number" class="editable" value="1" /></td>
            <td>pac</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/garam-masala.jpg" alt="Garam Masala" /></td>
            <td>GOROM MASALA</td>
            <td><input type="number" class="editable" value="1" /></td>
            <td>pac</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/kashmiri-chili.jpg" alt="Kashmiri Chili" /></td>
            <td>KASHMERI CHILLI</td>
            <td><input type="number" class="editable" value="1" /></td>
            <td>pac</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
          <tr>
            <td><img src="src/salt.jpg" alt="Salt" /></td>
            <td>SALT</td>
            <td><input type="number" class="editable" value="1" /></td>
            <td>pac</td>
            <td class="action" data-state="add">✔️</td>
          </tr>
        </tbody>
      </table>
    </div>

    <script>
      // Update table function
      function updateTable(updateURL = true) {
    let kgInput = document.getElementById("kgInput");
    let kg = parseFloat(kgInput.value);
    if (isNaN(kg) || kg <= 0) return;


    let inputs = document.querySelectorAll(".editable");
    let values = [];

    inputs.forEach(input => {
        let baseValue = input.dataset.base || input.value;
        input.dataset.base = baseValue; // Ensure base value is set

        let newValue = (baseValue * kg).toFixed(2); // Format to 2 decimal places
        newValue = newValue.replace(/\.?0+$/, ""); // Remove trailing .00 or .0

        input.value = newValue;
        values.push(newValue);
    });

    if (updateURL) updateURLParams(kg, values);
}


      // Add All and Remove All functions
      function addAll() {
        document.querySelectorAll(".action").forEach((action) => {
          action.dataset.state = "add";
          action.textContent = "✔️";
        });
        updateURLParams();
      }

      function removeAll() {
        document.querySelectorAll(".action").forEach((action) => {
          action.dataset.state = "remove";
          action.textContent = "❌";
        });
        updateURLParams();
      }

      // Reset function to restore table to original state
      function resetTable() {
    document.getElementById("kgInput").value = 1; // Reset kg input to 1 kg

    // Reset each editable input to its original base value
    let inputs = document.querySelectorAll(".editable");
    inputs.forEach(input => {
        input.value = input.dataset.base; // Restore base value from dataset
    });

    // Reset all actions to the default 'add' state (✔️)
    document.querySelectorAll(".action").forEach(action => {
        action.dataset.state = "add";
        action.textContent = "✔️"; // Reset to add state
    });

    // Remove URL parameters and reload page
    window.history.replaceState({}, document.title, window.location.pathname);
    location.reload(); // Reload the page
}

      // New function to toggle between ✔️ and ❌
      function toggleAction(element) {
        let state = element.dataset.state;

        if (state === "add") {
          element.textContent = "❌"; // Change to removed
          element.dataset.state = "remove";
        } else {
          element.textContent = "✔️"; // Change back to added
          element.dataset.state = "add";
        }

        updateURLParams(); // Update the URL when the action is toggled
      }

      // Attach click event listeners to action buttons (✔️/❌ toggle)
      function attachActionListeners() {
        document.querySelectorAll(".action").forEach((action) => {
          action.addEventListener("click", function () {
            toggleAction(this);
          });
        });
      }

      function updateURLParams(kg = null, values = null) {
        const newUrl = new URL(window.location);
        if (kg !== null) {
          newUrl.searchParams.set("kg", kg);
        } else {
          kg = parseFloat(document.getElementById("kgInput").value);
          newUrl.searchParams.set("kg", kg);
        }

        // Capture the current values of each editable field
        let inputs = document.querySelectorAll(".editable");
        let updatedValues =
          values || Array.from(inputs).map((input) => input.value);
        newUrl.searchParams.set("items", updatedValues.join(","));

        // Update the state of the actions (added/removed)
        let actions = Array.from(document.querySelectorAll(".action")).map(
          (action) => action.dataset.state
        );
        newUrl.searchParams.set("actions", actions.join(","));

        // Update the URL in the browser
        window.history.pushState({}, "", newUrl);
      }

      function loadFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        let kg = parseFloat(urlParams.get("kg")) || 1;
        document.getElementById("kgInput").value = kg;

        let items = urlParams.get("items");
        let inputs = document.querySelectorAll(".editable");

        if (items) {
          let values = items.split(",");
          inputs.forEach((input, index) => {
            if (values[index]) {
              input.value = values[index];
              // IMPORTANT: Set base value only if it hasn't been set before
              if (!input.dataset.base) {
                input.dataset.base = input.value / kg; // Set base value to restore later
              }
            }
          });
        } else {
          inputs.forEach((input) => {
            if (!input.dataset.base) {
              input.dataset.base = input.value; // Set base value on first load
            }
          });
        }

        // Load actions from the URL
        let actions = urlParams.get("actions");
        if (actions) {
          let actionStates = actions.split(",");
          document.querySelectorAll(".action").forEach((action, index) => {
            action.dataset.state = actionStates[index];
            action.textContent = actionStates[index] === "add" ? "✔️" : "❌";
          });
        }

        updateTable(false);
      }

      document
        .getElementById("kgInput")
        .addEventListener("keydown", function (event) {
          if (event.key === "Enter") {
            event.preventDefault();
            updateTable();
          }
        });

      // Single window.onload to avoid conflicts
      window.onload = function () {
        loadFromURL(); // Load existing URL parameters

        // Attach input listeners to update URL when individual item values change
        document.querySelectorAll(".editable").forEach((input) => {
          input.addEventListener("input", function () {
            updateURLParams(); // Update URL when individual input is changed
          });
        });

        // Attach event listeners to the action buttons
        attachActionListeners(); // Ensure the toggle works for ✔️ and ❌
      };
    </script>
  </body>
</html>